<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Lightning | <%= applocals.header %></title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="bower_components/Ionicons/css/ionicons.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="bower_components/datatables.net-bs/css/dataTables.bootstrap.css">
    <link rel="stylesheet" href="dist/css/AdminLTE.css">
    <!-- AdminLTE Skins. We have chosen the skin-blue for this starter
          page. However, you can choose any other skin. Make sure you
          apply the skin class to the body tag so the changes take effect. -->
    <link rel="stylesheet" href="dist/css/skins/_all-skins.css">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Google Font -->
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="manifest" href="/manifest.json">
    <!-- REQUIRED JS SCRIPTS -->
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap 3.3.7 -->
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- DataTables -->
    <script src="bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <!-- SlimScroll -->
    <script src="bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
    <!-- FastClick -->
    <script src="bower_components/fastclick/lib/fastclick.js"></script>
    <!-- AdminLTE App -->
    <script src="dist/js/adminlte.min.js"></script>
    
    <!-- AdminLTE for demo purposes -->
    <script src="dist/js/demo.js"></script>
    <script src="dist/js/jquery.inputmask.bundle.js"></script>
</head>
<!--
BODY TAG OPTIONS:
=================
Apply one or more of the following classes to get the
desired effect
|---------------------------------------------------------|
| SKINS         | skin-blue                               |
|               | skin-black                              |
|               | skin-purple                             |
|               | skin-yellow                             |
|               | skin-red                                |
|               | skin-green                              |
|---------------------------------------------------------|
|LAYOUT OPTIONS | fixed                                   |
|               | layout-boxed                            |
|               | layout-top-nav                          |
|               | sidebar-collapse                        |
|               | sidebar-mini                            |
|---------------------------------------------------------|
-->
<body class="hold-transition skin-blue sidebar-mini">
    <div class="wrapper">
        <!-- Main Header -->
        <header class="main-header">
            <!-- Logo -->
            <a href="/" class="logo hidden-xs">
                <!-- mini logo for sidebar mini 50x50 pixels -->
                <span class="logo-mini"><b>LND</b></span>
                <!-- logo for regular state and mobile devices -->
                <span class="logo-lg"><b>Bitcoin</b> LND</span>
            </a>
            <!-- Header Navbar -->
            <nav class="navbar navbar-static-top" role="navigation">
                <!-- Sidebar toggle button-->
                <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
                    <span class="sr-only">Toggle navigation</span>
                </a>

                <div class="hidden-xs" style="float:left;background-color:transparent;background-image:none;padding:15px 15px;font-family:fontAwesome;color:#fff;" id="div_peer_pubkey">Pubkey: ...</div>
                <div class="mobile-header hidden-sm hidden-md hidden-lg hidden-xl"><b>Bitcoin</b> LND</div>
                <!-- Navbar Right Menu -->
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <!-- User Account Menu -->
                        <li class="dropdown user user-menu">
                            <!-- Menu Toggle Button -->
                            <a href="/" class="dropdown-toggle" data-toggle="dropdown">
                                <!-- The user image in the navbar-->
                                <img src="images/lightning.jpg" class="user-image" alt="User Image">
                                <!-- hidden-xs hides the username on small devices so only the image appears. -->
                                <span id="alias_header" class="hidden-xs">ALIAS</span>
                            </a>
                            <ul class="dropdown-menu">
                                <!-- The user image in the menu -->
                                <li class="user-header">
                                    <p>Change Alias</p>
                                    <!-- alias form (Optional) -->
                                    <form method="get" class="sidebar-form">
                                        <div class="input-group">
                                            <input type="text" name="q" class="form-control" placeholder="Node Alias..." id="input_node_alias">
                                            <span class="input-group-btn">
                                                <button name="search" id="search-btn" class="btn btn-flat" onclick="newAlias($('#input_node_alias').val()); return false;">
                                                    <i class="fa fa-wrench"></i>
                                                </button>
                                            </span>
                                        </div>
                                    </form>
                                </li>
                                <!-- Menu Body
                                <li class="user-body">
                                    <div class="row">
                                        <div class="col-xs-4 text-center">
                                            <a href="#">Followers</a>
                                        </div>
                                        <div class="col-xs-4 text-center">
                                            <a href="#">Sales</a>
                                        </div>
                                        <div class="col-xs-4 text-center">
                                            <a href="#">Friends</a>
                                        </div>
                                    </div>
                                    <!-- /.row
                                </li>
                                <!-- Menu Footer
                                <li class="user-footer">
                                    <div class="pull-left">
                                        <a href="#" class="btn btn-default btn-flat">Profile</a>
                                    </div>
                                    <div class="pull-right">
                                        <a href="#" class="btn btn-default btn-flat">Sign out</a>
                                    </div>
                                </li>-->
                            </ul>
                        </li>
                        <!-- Control Sidebar Toggle Button -->
                        <li>
                            <a href="#" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <!-- Left side column. contains the logo and sidebar -->
        <aside class="main-sidebar">
            <!-- sidebar: style can be found in sidebar.less -->
            <section class="sidebar">
                <!-- Sidebar user panel (optional) -->
                <div class="user-panel">
                    <div class="flex-row white">
                        <div class="image">
                            <img src="images/lightning.jpg" class="img-circle" alt="User Image">
                        </div>
                        <div class="info chaindata">
                            <span class="network_mode">Network</span><br />
                            <!-- Status -->
                            <a><i class="fa fa-circle text-success"></i> Online</a>
                        </div>

                    </div>

                    <div class="white chaindata">
                        Time: <span class="lastblock"></span><br />
                        Height: <span class="blockheight"></span><br />
                    </div>
                </div>

                <!-- /.search form -->
                <!-- Sidebar Menu -->
                <ul class="sidebar-menu" data-widget="tree">
                    <!-- Optionally, you can add icons to the links -->
                    <li class="active"><a href="/"><i class="fa fa-dashboard"></i> <span>Dashboard</span></a></li>
                    <li><a href="pay"><i class="ion ion-paper-airplane"></i> <span>Pay</span></a></li>
                    <li class="treeview">
                        <a href="#">
                            <i class="ion ion-pie-graph"></i> <span>Channels</span>
                            <span class="pull-right-container">
                                <i class="fa fa-angle-left pull-right"></i>
                            </span>
                        </a>
                        <ul class="treeview-menu">
                            <li><a href="openchannel"><i class="ion ion-ios-plus-outline"></i> Open New Channel</a></li>
                            <li><a href="activechannels"><i class="ion ion-ios-lightbulb-outline"></i> Active Channels</a></li>
                            <li><a href="pendingchannels"><i class="ion ion-ios-timer-outline"></i> Pending Channels</a></li>
                            <li><a href="closingchannels"><i class="ion ion-ios-close-outline"></i> Closing Channels</a></li>
                        </ul>
                    </li>
                    <li class="treeview">
                        <a href="#">
                            <i class="ion ion-bag"></i> <span>Invoices</span>
                            <span class="pull-right-container">
                                <i class="fa fa-angle-left pull-right"></i>
                            </span>
                        </a>
                        <ul class="treeview-menu">
                            <li><a href="newinvoice"><i class="ion ion-ios-plus-outline"></i> New Invoice</a></li>
                            <li><a href="paidinvoices"><i class="fa fa-circle-o"></i> Paid Invoices</a></li>
                            <li><a href="pendinginvoices"><i class="ion ion-ios-timer-outline"></i> Pending Invoices</a></li>
                        </ul>
                    </li>
                    <li class="treeview">
                        <a href="#">
                            <i class="ion ion-arrow-swap"></i> <span>Transactions</span>
                            <span class="pull-right-container">
                                <i class="fa fa-angle-left pull-right"></i>
                            </span>
                        </a>
                        <ul class="treeview-menu">
                            <li><a href="channel_transactions"><i class="ion ion-flash"></i> In Channels</a></li>
                            <li><a href="chain_transactions"><i class="ion ion-social-bitcoin"></i> On Chain</a></li>
                        </ul>
                    </li>
                    <li><a href="peers"><i class="ion ion-network"></i> <span>Peers</span></a></li>
                    <li><a href="javascript: logout()"><i class="ion ion-log-out"></i> <span>Logout</span></a></li>
                    <li>
                        <a>
                            <i class="ion ion-social-bitcoin"></i> <span>On Chain</span>
                            <span class="pull-right-container">
                                <small class="label pull-right bg-aqua"><span style="font-size:12px;" id="span_wallet_balance" class="btc">0</span> (<span class="unit-label">SAT</span>)</small>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a>
                            <i class="ion ion-flash"></i> <span>Channels</span>
                            <span class="pull-right-container">
                                <small class="label pull-right bg-green"><span style="font-size:12px;" id="span_channel_balance" class="btc">0</span> (<span class="unit-label">SAT</span>)</small>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a>
                            <i class="ion ion-key"></i> <span>Total</span>
                            <span class="pull-right-container">
                                <small class="label pull-right bg-blue"><span style="font-size:12px;" class="total_sats btc">0</span> (<span class="unit-label">SAT</span>)</small>
                            </span>
                        </a>
                    </li>
                </ul>
                <!-- /.sidebar-menu -->
            </section>
            <!-- /.sidebar -->
        </aside>
        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <h1>
                    <%= applocals.header %>
                    <small><%= applocals.header_small %></small>
                </h1>
                <ol class="breadcrumb">
                    <li><a href="/"><i class="fa fa-dashboard"></i> Dashboard</a></li>
                    <li class="active"><%= applocals.header %></li>
                </ol>
            </section>
            <!-- Main content -->
            <section class="content container-fluid">


                <div class="callout callout-danger" id="notify_danger" style="display:none;">
                    <h4 id="notify_danger_title"><i class="icon fa fa-ban"></i> Error<button type="button" class="btn btn-box-tool pull-right" data-widget="remove" style="padding:0px; color: #FFF;" onclick="$('#notify_danger').css('display', 'none');"><i class="fa fa-times"></i></button></h4>

                    <p id="notify_danger_message">
                        There is a problem that we need to fix. A wonderful serenity has taken possession of my entire soul,
                        like these sweet mornings of spring which I enjoy with my whole heart.
                    </p>
                </div>
                <div class="callout callout-info" id="notify_info" style="display:none;">
                    <h4 id="notify_info_title"><i class="icon fa fa-info"></i> Info<button type="button" class="btn btn-box-tool pull-right" data-widget="remove" style="padding:0px; color: #FFF;" onclick="$('#notify_info').css('display', 'none');"><i class="fa fa-times"></i></button></h4>

                    <p id="notify_info_message">Follow the steps to continue to payment.</p>
                </div>
                <div class="callout callout-warning" id="notify_warning" style="display:none;">
                    <h4 id="notify_warning_title"><i class="icon fa fa-warning"></i> Alert<button type="button" class="btn btn-box-tool pull-right" data-widget="remove" style="padding:0px; color: #FFF;" onclick="$('#notify_warning').css('display', 'none');"><i class="fa fa-times"></i></button></h4>

                    <p id="notify_warning_message">This is a yellow callout.</p>
                </div>
                <div class="callout callout-success" id="notify_success" style="display:none;">
                    <h4 id="notify_success_title"><i class="icon fa fa-check"></i> Success<button type="button" class="btn btn-box-tool pull-right" data-widget="remove" style="padding:0px; color: #FFF;" onclick="$('#notify_success').css('display', 'none');"><i class="fa fa-times"></i></button></h4>

                    <p id="notify_success_message">This is a green callout.</p>
                </div>


                <%- body %>
                <!--------------------------
                  | Your Page Content Here |
                  -------------------------->
            </section>
            <!-- /.content -->
        </div>
        <!-- /.content-wrapper -->
        <!-- Main Footer -->
        <footer class="main-footer">
            <!-- To the right -->
            <div class="pull-right hidden-xs">
                The revolution will not ฿e centralized !
            </div>
            <!-- Default to the left -->
            <strong>Copyright &copy; 2019 <a href="https://github.com/lightningnetwork/lnd" target="_blank">LND</a>.</strong> All rights reserved.
        </footer>
        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <!-- Create the tabs -->
            <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
                <li class="active"><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>
                <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
            </ul>
            <!-- Tab panes -->
            <div class="tab-content">
                <!-- Home tab content -->
                <div class="tab-pane active" id="control-sidebar-home-tab">
                    <!--      <h3 class="control-sidebar-heading">Recent Activity</h3>
                          <ul class="control-sidebar-menu">
                              <li>
                                  <a href="javascript:;">
                                      <i class="menu-icon fa fa-birthday-cake bg-red"></i>
                                      <div class="menu-info">
                                          <h4 class="control-sidebar-subheading">Langdon's Birthday</h4>
                                          <p>Will be 23 on April 24th</p>
                                      </div>
                                  </a>
                              </li>
                          </ul> -->
                    <!-- /.control-sidebar-menu -->
                    <!--    <h3 class="control-sidebar-heading">Tasks Progress</h3>
                        <ul class="control-sidebar-menu">
                            <li>
                                <a href="javascript:;">
                                    <h4 class="control-sidebar-subheading">
                                        Custom Template Design
                                        <span class="pull-right-container">
                                            <span class="label label-danger pull-right">70%</span>
                                        </span>
                                    </h4>
                                    <div class="progress progress-xxs">
                                        <div class="progress-bar progress-bar-danger" style="width: 70%"></div>
                                    </div>
                                </a>
                            </li>
                        </ul> -->
                    <!-- /.control-sidebar-menu -->
                </div>
                <!-- /.tab-pane -->
                <!-- Stats tab content -->
                <div class="tab-pane" id="control-sidebar-stats-tab">Stats Tab Content</div>
                <!-- /.tab-pane -->
                <!-- Settings tab content -->
                <div class="tab-pane" id="control-sidebar-settings-tab">
                    <form method="post">
                        <h3 class="control-sidebar-heading">Node Settings</h3>
                        <div class="form-group">
                            <label class="control-sidebar-subheading">
                                <button type="button" class="btn btn-info btn-flat" id="start_lnd">Start LND</button>
                                <button type="button" class="btn btn-info btn-flat" id="stop_lnd">Stop LND</button>
                            </label>
                            <p>
                                Stop and start LND
                            </p>
                        </div>
                        <!-- /.form-group -->
                        <div class="form-group">
                            <label class="control-sidebar-subheading">
                                LND Autopilot
                                <input type="checkbox" class="pull-right" checked>
                            </label>
                            <p>
                                Enable LND to manage channels at will
                            </p>
                        </div>
                        <!-- /.form-group -->
                        <div class="form-group">
                            <label class="control-sidebar-subheading">
                                LND Autopilot Minimum Channel Size
                                <input type="number" class="pull-right form-control">
                            </label>
                            <p>
                                Smallest size channel Autopilot will attempt to create
                            </p>
                        </div>
                        <!-- /.form-group -->
                        <div class="form-group">
                            <label class="control-sidebar-subheading">
                                LND Autopilot Maximum Channel Size
                                <input type="number" class="pull-right form-control">
                            </label>
                            <p>
                                Largest size channel Autopilot will attempt to create
                            </p>
                        </div>
                        <!-- /.form-group -->
                    </form>
                </div>
                <!-- /.tab-pane -->
            </div>
        </aside>
        <!-- /.control-sidebar -->
        <!-- Add the sidebar's background. This div must be placed
        immediately after the control sidebar -->
        <div class="control-sidebar-bg"></div>
    </div>
    <!-- ./wrapper -->


    <script>

        function notify_handler(type, message) {

            $('#notify_danger').css('display', 'none');
            $('#notify_info').css('display', 'none');
            $('#notify_warning').css('display', 'none');
            $('#notify_success').css('display', 'none');

            if (type == 'success') {
                $('#notify_success_message').html(message);
                $('#notify_success').css('display', 'block');
            } else if (type == 'info') {
                $('#notify_info_message').html(message);
                $('#notify_info').css('display', 'block');
            } else if (type == 'warning') {
                $('#notify_warning_message').html(message);
                $('#notify_warning').css('display', 'block');
            } else {
                $('#notify_danger_message').html(message);
                $('#notify_danger').css('display', 'block');
            }
        }

    </script>

    <script>
        $(function () {
            $('#amount').inputmask("numeric", {
                radixPoint: ".",
                groupSeparator: ",",
                digits: 0,
                autoGroup: true,
                //prefix: '$', //No Space, this will truncate the first character
                rightAlign: false,
                oncleared: function () { self.Value(''); }
            });
            $('#example1').DataTable();
            //$('#example2').DataTable({
            //    'paging': true,
            //    'lengthChange': false,
            //    'searching': false,
            //    'ordering': false,
            //    'info': false,
            //    'autoWidth': false
            //})
        })
    </script>

    <script>
        function logout() {
            document.cookie = "lndauth=; expires=" + new Date(0).toUTCString() + "; path=/;";
            window.location.href = "/";
        }

        function getAbsolutePath() {
            var loc = window.location;
            var pathName = loc.pathname.substring(0, loc.pathname.lastIndexOf('/') + 1);
            return loc.href.substring(0, loc.href.length - ((loc.pathname + loc.search + loc.hash).length - pathName.length));
        }

        function newAlias(new_alias) {
            console.log('new alias = ' + new_alias);
            $.post("/call",
                "method_name=setAlias&new_alias=" + new_alias,
                function (jsonresult) {
                    if (jsonresult.status == 'success') {
                        $("#input_node_alias").val(jsonresult.data);
                        console.log(jsonresult.data);
                    }
                });
            return false;
        }

        $(document).ajaxComplete(function (event, xhr, settings) {
            if (xhr.status == 401)
                window.location.href = "/";
        });

        if ("Notification" in window && Notification.permission !== "denied")
            Notification.requestPermission();

        function notify(msg, title) {
            if (!("Notification" in window))
                return false;

            if (Notification.permission === "granted") {
                var notification = new Notification(title, { body: msg, badge: 'images/lightning.jpg', icon: 'images/lightning.jpg' });
                return true;
            }
        }

        //currencies supported
        var currencies = {};
        currencies.SAT = (sats, currency) => {
            return Number(sats);
        };
        currencies.BTC = (sats, currency) => {
            return Number(sats) / Number(100000000);
        }
        currencies.fiat = async (sats, currency) => {
            var response = await $.get({ url: "https://api.coindesk.com/v1/bpi/currentprice/" + currency + ".json", async: false });
            var rate = JSON.parse(response).bpi[currency].rate_float;
            var res = (Number(sats) / Number(100000000) * rate).toFixed(2);
            return res;
        }

        var order = ["SAT", "BTC", "USD", "EUR", "CAD"];

        $(".btc").on("click", function (e) {
            var currentUnit = $(".unit-label").html();
            var orderIndex = order.indexOf(currentUnit) == order.length - 1 ? 0 : order.indexOf(currentUnit) + 1;
            var newUnit = order[orderIndex];
            $(".btc").each(async function () {
                var sats = $(this).attr('data-sats');

                if (newUnit == "BTC" || newUnit == "SAT") {
                    var res = await currencies[newUnit](sats, newUnit);
                    $(this).html(res.toLocaleString());
                }
                else {
                    var res = await currencies.fiat(sats, newUnit);
                    $(this).html(res.toLocaleString());
                }
            });
            $(".unit-label").html(newUnit);
        });

        async function updateSats(id, sats) {
            var currentUnit = $(".unit-label").html();
            var currency = currentUnit == "BTC" || currentUnit == "SAT" ? currentUnit : "fiat";
            if ($("#" + id)) {
                $("#" + id).attr("data-sats", sats);
                var res = await currencies[currency](sats, currentUnit);
                $("#" + id).html(res.toLocaleString());
            }

            if ($("." + id)) {
                $("." + id).attr("data-sats", sats);
                var res = await currencies[currency](sats, currentUnit);
                $("." + id).html(res.toLocaleString());
            }
        }

    </script>
    <!-- Websockets for notifications and state data -->
    <script src="js/websockets.js"></script>
    <script>
        window.addEventListener('beforeinstallprompt', (e) => {
            e.prompt();
            });
    </script>
</body>
</html>